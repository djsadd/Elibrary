type Lang = 'en' | 'ru' | 'kk';

const dict: Record<Lang, Record<string, any>> = {
  en: {
    admin: {
      nav: {
        overview: 'Overview',
        books: 'Books',
        addBook: 'Add Book',
        playlists: 'Playlists',
        addPlaylist: 'Add Playlist',
        authors: 'Authors',
        subjects: 'Subjects',
        files: 'Files',
        users: 'Users',
        roles: 'Roles',
        reports: 'Reports',
        settings: 'Settings',
      },
      common: {
        catalogSearchPlaceholder: 'Search catalog',
        loading: 'Loading�',
        failed: 'Failed to load',
        actions: 'Actions',
        edit: 'Edit',
        delete: 'Delete',
        create: 'Create',
        add: 'Add',
        cancel: 'Cancel',
        search: 'Search�',
        selected: 'Selected',
        noResults: 'No results',
        confirmDeleteBook: 'Delete this book?',
      },
      home: {
        heading: 'Admin Dashboard',
        addBookBtn: 'Add Book',
        addPlaylistBtn: 'Add Playlist',
        empty: 'No books yet. Click "Add Book" to create one.',
        table: { title: 'Title', authors: 'Authors', subjects: 'Subjects', created: 'Created' },
      },
      books: {
        heading: 'Books',
        addBook: 'Add book',
        table: { title: 'Title', year: 'Year', lang: 'Lang', authors: 'Authors', actions: 'Actions' },
        empty: 'No books',
      },
      playlists: {
        heading: 'Playlists',
        add: 'Add',
        searchPlaceholder: 'Search…',
        table: { title: 'Title', description: 'Description', books: 'Books', created: 'Created', actions: 'Actions' },
        empty: 'No playlists yet',
        modal: {
          title: 'Add Playlist',
          close: 'Close',
          form: {
            title: 'Title',
            description: 'Description (optional)',
            cancel: 'Cancel',
            creating: 'Adding…',
            create: 'Create',
          },
          errors: { requiredTitle: 'Title is required' },
        },
        booksPicker: {
          label: 'Books',
          placeholder: 'Type to search title or author',
          loading: 'Loading…',
          failed: 'Failed to load books',
        },
      },
      taxonomy: {
        authors: {
          heading: 'Authors',
          subheading: 'Browse and search authors',
          addLabel: 'Add Author',
          namePlaceholder: 'Author name',
          adding: 'Adding…',
          add: 'Add',
          searchPlaceholder: 'Search authors...',
          empty: 'No authors found.',
        },
        subjects: {
          heading: 'Subjects',
          subheading: 'Browse and search subjects',
          addLabel: 'Add Subject',
          namePlaceholder: 'Subject name',
          adding: 'Adding…',
          add: 'Add',
          searchPlaceholder: 'Search subjects...',
          empty: 'No subjects found.',
        },
        errors: { nameRequired: 'Name is required', nameTooLong: 'Name too long (max 256)', addedOk: 'Added' },
      },
    },
    shelf: {
      title: 'My Shelf',
      tabs: {
        EBOOK: 'E-Books',
        AUDIOBOOK: 'Audio Books',
        VIDEOBOOK: 'Video Books',
        INTERACTIVE: 'Interactive',
        HARDCOPY: 'Hardcopy',
      },
      failed: 'Failed to load',
      empty: 'No books here yet.',
    },
    nav: {
      home: 'Home',
      catalog: 'Catalog',
      shelf: 'My Shelf',
      admin: 'Admin',
      profile: 'Profile',
      contribute: 'Contribute',
      favorites: 'Favorites',
    },
    catalog: {
      title: 'Catalog',
      secondEdition: 'Second Edition',
      readOnline: 'Read Online',
      openReader: 'Open Reader',
      downloadPdf: 'Download PDF',
      addFav: 'Add to Favorites',
      removeFav: 'Remove from Favorites',
      currentlyReading: 'Currently reading',
      haveRead: 'Have read',
      tabs: { overview: 'Overview', details: 'Details', reviews: 'Reviews', lists: 'Lists', related: 'Related' },
      fields: { publishDate: 'Publish Date', publisher: 'Publisher', language: 'Language', formats: 'Formats' },
      aboutAuthor: 'About Author',
      actions: { review: 'Review', notes: 'Notes', share: 'Share' },
    },
    favorites: {
      title: 'Favorites',
      none: 'You have no favorites yet.',
      loadMore: 'Scroll to load more',
      loadingMore: 'Loading more…',
      failed: 'Failed to load',
    },
    common: {
      catalogSearchPlaceholder: 'Search catalog',
      loading: 'Loading…',
      noBooks: 'No books found',
      back: 'Back',
      notes: 'Notes',
      saving: 'Saving…',
      saved: 'Saved',
      error: 'Error',
      autosave: 'Auto-save',
    },
  },
  ru: {
    admin: {
      nav: {
        overview: 'Обзор',
        books: 'Книги',
        addBook: 'Добавить книгу',
        playlists: 'Подборки',
        addPlaylist: 'Добавить подборку',
        authors: 'Авторы',
        subjects: 'Темы',
        files: 'Файлы',
        users: 'Пользователи',
        roles: 'Роли',
        reports: 'Отчеты',
        settings: 'Настройки',
      },
      common: {
        catalogSearchPlaceholder: 'Поиск по каталогу',
        loading: '���������',
        failed: '�� ������� ���������',
        actions: '��������',
        edit: '�������������',
        delete: '�������',
        create: '�������',
        add: '��������',
        cancel: '������',
        search: '�����',
        selected: '�������',
        noResults: '��� �����������',
        confirmDeleteBook: '������� ��� �����?',
      },
      home: {
        heading: 'Админ-панель',
        addBookBtn: 'Добавить книгу',
        addPlaylistBtn: 'Добавить подборку',
        empty: 'Книг пока нет. Нажмите «Добавить книгу», чтобы создать.',
        table: { title: 'Название', authors: 'Авторы', subjects: 'Темы', created: 'Создано' },
      },
      books: {
        heading: 'Книги',
        addBook: 'Добавить книгу',
        table: { title: 'Название', year: 'Год', lang: 'Язык', authors: 'Авторы', actions: 'Действия' },
        empty: 'Нет книг',
      },
      playlists: {
        heading: 'Подборки',
        add: 'Добавить',
        searchPlaceholder: 'Поиск…',
        table: { title: 'Название', description: 'Описание', books: 'Книги', created: 'Создано', actions: 'Действия' },
        empty: 'Пока нет подборок',
        modal: {
          title: 'Добавить подборку',
          close: 'Закрыть',
          form: {
            title: 'Название',
            description: 'Описание (необязательно)',
            cancel: 'Отмена',
            creating: 'Добавление…',
            create: 'Создать',
          },
          errors: { requiredTitle: 'Нужно название' },
        },
        booksPicker: {
          label: 'Книги',
          placeholder: 'Введите название или автора',
          loading: 'Загрузка…',
          failed: 'Не удалось загрузить книги',
        },
      },
      taxonomy: {
        authors: {
          heading: 'Авторы',
          subheading: 'Просмотр и поиск авторов',
          addLabel: 'Добавить автора',
          namePlaceholder: 'Имя автора',
          adding: 'Добавление…',
          add: 'Добавить',
          searchPlaceholder: 'Поиск авторов...',
          empty: 'Авторы не найдены.',
        },
        subjects: {
          heading: 'Темы',
          subheading: 'Просмотр и поиск тем',
          addLabel: 'Добавить тему',
          namePlaceholder: 'Название темы',
          adding: 'Добавление…',
          add: 'Добавить',
          searchPlaceholder: 'Поиск тем...',
          empty: 'Темы не найдены.',
        },
        errors: { nameRequired: 'Нужно имя', nameTooLong: 'Слишком длинное имя (макс. 256)', addedOk: 'Добавлено' },
      },
    },
    shelf: {
      title: 'Моя полка',
      tabs: {
        EBOOK: 'Электронные книги',
        AUDIOBOOK: 'Аудиокниги',
        VIDEOBOOK: 'Видеокниги',
        INTERACTIVE: 'Интерактивные',
        HARDCOPY: 'Печатные',
      },
      failed: 'Не удалось загрузить',
      empty: 'Здесь пока нет книг.',
    },
    nav: {
      home: 'Главная',
      catalog: 'Каталог',
      shelf: 'Моя полка',
      admin: 'Админ',
      profile: 'Профиль',
      contribute: 'Вклад',
      favorites: 'Избранное',
    },
    catalog: {
      title: 'Каталог',
      secondEdition: 'Второе издание',
      readOnline: 'Читать онлайн',
      openReader: 'Открыть ридер',
      downloadPdf: 'Скачать PDF',
      addFav: 'В избранное',
      removeFav: 'Убрать из избранного',
      currentlyReading: 'Сейчас читают',
      haveRead: 'Прочитали',
      tabs: { overview: 'Обзор', details: 'Детали', reviews: 'Отзывы', lists: 'Списки', related: 'Похожие' },
      fields: { publishDate: 'Дата издания', publisher: 'Издатель', language: 'Язык', formats: 'Форматы' },
      aboutAuthor: 'Об авторе',
      actions: { review: 'Отзыв', notes: 'Заметки', share: 'Поделиться' },
    },
    favorites: {
      title: 'Избранное',
      none: 'У вас пока нет избранного.',
      loadMore: 'Прокрутите для загрузки',
      loadingMore: 'Загружаем…',
      failed: 'Не удалось загрузить',
    },
    common: {
      loading: 'Загрузка…',
      noBooks: 'Книги не найдены',
      back: 'Назад',
      notes: 'Заметки',
      saving: 'Сохраняем…',
      saved: 'Сохранено',
      error: 'Ошибка',
      autosave: 'Автосохранение',
    },
  },
  kk: {
    admin: {
      nav: {
        overview: 'Шолу',
        books: 'Кітаптар',
        addBook: 'Кітап қосу',
        playlists: 'Ойнату тізімдері',
        addPlaylist: 'Ойнату тізімін қосу',
        authors: 'Авторлар',
        subjects: 'Тақырыптар',
        files: 'Файлдар',
        users: 'Қолданушылар',
        roles: 'Рөлдер',
        reports: 'Есептер',
        settings: 'Баптаулар',
      },
      common: {
        catalogSearchPlaceholder: 'Каталогты іздеу',
        loading: 'Жүктелуде…',
        failed: 'Жүктеу сәтсіз аяқталды',
        actions: 'Әрекеттер',
        edit: 'Өңдеу',
        delete: 'Жою',
        create: 'Құру',
        add: 'Қосу',
        cancel: 'Болдырмау',
        search: 'Іздеу…',
        selected: 'Таңдалды',
        noResults: 'Нәтижелер жоқ',
        confirmDeleteBook: 'Осы кітапты жойғыңыз келе ме?',
      },
      home: {
        heading: 'Әкімші тақтасы',
        addBookBtn: 'Кітап қосу',
        addPlaylistBtn: 'Ойнату тізімі қосу',
        empty: 'Әзірге кітаптар жоқ. "Кітап қосу" түймесін басып, жаңа кітап жасаңыз.',
        table: { title: 'Атауы', authors: 'Авторлар', subjects: 'Тақырыптар', created: 'Жасалған' },
      },
      books: {
        heading: 'Кітаптар',
        addBook: 'Кітап қосу',
        table: { title: 'Атауы', year: 'Жылы', lang: 'Тілі', authors: 'Авторлар', actions: 'Әрекеттер' },
        empty: 'Кітаптар табылмады',
      },
      playlists: {
        heading: 'Ойнату тізімдері',
        add: 'Қосу',
        searchPlaceholder: 'Іздеңіз…',
        table: { title: 'Атауы', description: 'Сипаттамасы', books: 'Кітаптар', created: 'Жасалған', actions: 'Әрекеттер' },
        empty: 'Әзірге ойнату тізімдері жоқ',
        modal: {
          title: 'Ойнату тізімін қосу',
          close: 'Жабу',
          form: {
            title: 'Атауы',
            description: 'Сипаттамасы (міндетті емес)',
            cancel: 'Болдырмау',
            creating: 'Қосылуда…',
            create: 'Құру',
          },
          errors: { requiredTitle: 'Атауы міндетті' },
        },
        booksPicker: {
          label: 'Кітаптар',
          placeholder: 'Атауы немесе авторын теріңіз',
          loading: 'Жүктелуде…',
          failed: 'Кітаптарды жүктеу мүмкін болмады',
        },
      },
      taxonomy: {
        authors: {
          heading: 'Авторлар',
          subheading: 'Авторларды қарап, іздеңіз',
          addLabel: 'Автор қосу',
          namePlaceholder: 'Автордың аты',
          adding: 'Қосылуда…',
          add: 'Қосу',
          searchPlaceholder: 'Авторларды іздеу…',
          empty: 'Автор табылмады.',
        },
        subjects: {
          heading: 'Тақырыптар',
          subheading: 'Тақырыптарды қарап, іздеңіз',
          addLabel: 'Тақырып қосу',
          namePlaceholder: 'Тақырып атауы',
          adding: 'Қосылуда…',
          add: 'Қосу',
          searchPlaceholder: 'Тақырыптарды іздеу…',
          empty: 'Тақырыптар табылмады.',
        },
        errors: { nameRequired: 'Атауы қажет', nameTooLong: 'Атауы тым ұзақ (max 256)', addedOk: 'Қосылды' },
      },
    },
    shelf: {
      title: 'Менің сөрем',
      tabs: {
        EBOOK: 'Электронды кітаптар',
        AUDIOBOOK: 'Аудиокітаптар',
        VIDEOBOOK: 'Видео кітаптар',
        INTERACTIVE: 'Интерактивті',
        HARDCOPY: 'Баспа',
      },
      failed: 'Жүктеу сәтсіз аяқталды',
      empty: 'Әзірге кітаптар жоқ.',
    },
    nav: {
      home: 'Басты бет',
      catalog: 'Каталог',
      shelf: 'Менің сөрем',
      admin: 'Әкімші',
      profile: 'Профиль',
      contribute: 'Қосылу',
      favorites: 'Таңдаулылар',
    },
    catalog: {
      title: 'Каталог',
      secondEdition: 'Екінші шығарылым',
      readOnline: 'Онлайн оқу',
      openReader: 'Оқырманды ашу',
      downloadPdf: 'PDF жүктеу',
      addFav: 'Таңдаулыларға қосу',
      removeFav: 'Таңдаулылардан алып тастау',
      currentlyReading: 'Қазіргі уақытта оқылуда',
      haveRead: 'Оқылған',
      tabs: { overview: 'Шолу', details: 'Толық ақпарат', reviews: 'Пікірлер', lists: 'Тізімдер', related: 'Қатысты' },
      fields: { publishDate: 'Жарияланған күні', publisher: 'Баспа', language: 'Тілі', formats: 'Форматтары' },
      aboutAuthor: 'Автор туралы',
      actions: { review: 'Пікір қосу', notes: 'Ескертпелер', share: 'Бөлісу' },
    },
    favorites: {
      title: 'Таңдаулылар',
      none: 'Әзірге таңдаулар жоқ.',
      loadMore: 'Қосымша жүктеу үшін сырғытыңыз',
      loadingMore: 'Қосымша жүктелуде…',
      failed: 'Жүктеу сәтсіз аяқталды',
    },
    common: {
      loading: 'Жүктелуде…',
      noBooks: 'Кітаптар табылмады',
      back: 'Қайту',
      notes: 'Ескертпелер',
      saving: 'Сақталуда…',
      saved: 'Сақталды',
      error: 'Қате',
      autosave: 'Автоматты сақтау',
    },
  },
};

export function getLang(): Lang {
  try {
    const raw = (localStorage.getItem('ui_lang') || '').toLowerCase();
    if (raw.startsWith('ru')) return 'ru';
    if (raw.startsWith('kk')) return 'kk';
    if (raw.startsWith('en')) return 'en';
  } catch {}
  try {
    const nav = (navigator?.language || '').toLowerCase();
    if (nav.startsWith('ru')) return 'ru';
    if (nav.startsWith('kk')) return 'kk';
  } catch {}
  return 'en';
}

export function t(path: string, vars?: Record<string, any>): string {
  const lang = getLang();
  const val = lookup(dict[lang], path) ?? lookup(dict.en, path) ?? path;
  if (!vars) return val;
  return Object.keys(vars).reduce((acc, k) => acc.replace(new RegExp(`\\{\\{${k}\\}\\}`, 'g'), String(vars[k])), val);
}

dict.en.common.catalogSearchPlaceholder = "Search catalog";
dict.ru.common.catalogSearchPlaceholder = "Поиск по каталогу";
dict.kk.common.catalogSearchPlaceholder = "Каталогты іздеу";

dict.en.auth = {
  login: {
    title: "Welcome Back !",
    subtitle: "Sign in to continue to your Digital Library",
    emailLabel: "Email",
    passwordLabel: "Password",
    passwordPlaceholder: "Enter your password",
    remember: "Remember me",
    forgot: "Forgot password?",
    submit: "Login",
    errorMissing: "Please provide both email and password.",
    actionLink: "Register now",
    guest: "Use as Guest",
  },
  register: {
    title: "Registration",
    subtitle: "For Both Staff & Students",
    regNo: "Reg No.",
    email: "College Email ID",
    password: "Password",
    confirmPassword: "Confirm Password",
    submit: "Register",
    success: "Registering...",
    actionLink: "Login now",
    guest: "Use as Guest",
  },
};

dict.ru.auth = {
  login: {
    title: "С возвращением!",
    subtitle: "Войдите, чтобы продолжить работу с вашей Библиотекой",
    emailLabel: "Эл. почта",
    passwordLabel: "Пароль",
    passwordPlaceholder: "Введите пароль",
    remember: "Запомнить меня",
    forgot: "Забыли пароль?",
    submit: "Войти",
    errorMissing: "Пожалуйста, укажите и email, и пароль.",
    actionLink: "Зарегистрируйтесь",
    guest: "Войти как гость",
  },
  register: {
    title: "Регистрация",
    subtitle: "Для сотрудников и студентов",
    regNo: "Рег. номер",
    email: "Колледж Эл. почта",
    password: "Пароль",
    confirmPassword: "Подтвердите пароль",
    submit: "Зарегистрироваться",
    success: "Регистрация...",
    actionLink: "Уже есть аккаунт?",
    guest: "Войти как гость",
  },
};

dict.kk.auth = {
  login: {
    title: "Қайтып келдіңіз!",
    subtitle: "Сандық кітапханаңызға кіру үшін жүйеге кіріңіз",
    emailLabel: "Электронды пошта",
    passwordLabel: "Құпия сөз",
    passwordPlaceholder: "Құпия сөзді енгізіңіз",
    remember: "Жүйені есте сақтау",
    forgot: "Құпия сөзді ұмыттыңыз ба?",
    submit: "Кіру",
    errorMissing: "Пошта мен құпия сөзді енгізіңіз.",
    actionLink: "Тіркеліңіз",
    guest: "Қонақ ретінде кіру",
  },
  register: {
    title: "Тіркелу",
    subtitle: "Қызметкерлер мен студенттерге арналған",
    regNo: "Жүйелік нөмір",
    email: "Колледж электронды поштасы",
    password: "Құпия сөз",
    confirmPassword: "Құпия сөзді растаңыз",
    submit: "Тіркелу",
    success: "Тіркелуде...",
    actionLink: "Қазір кіріңіз",
    guest: "Қонақ ретінде кіру",
  },
};

function lookup(obj: any, path: string): string | undefined {
  return path.split('.').reduce((o, k) => (o && typeof o === 'object' ? o[k] : undefined), obj);
}
